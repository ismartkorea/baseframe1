<%- layout('./layout') -%>
<%
// 콤마 붙이기
function fnComma(num) {
    var reg = /(^[+-]?\d+)(\d{3})/;
    num += '';
    while(reg.test(num)) {
        num = num.replace(reg, '$1' + ',' + '$2');
    }
    return num;
}
// 콤마 제거
function fnUnComma(num) {
    return (num.replace(/\,/g,""));
}

/**
 * 잔여 일수 계산
 * @param starDt
 * @param endDt
 */
function fncRemainDay(endDt) {
    var day = 1000 * 60 * 60 * 24;
    var month = day * 30;
    var year = month * 12;
    var remainDay = 0;

//console.log('fncRemainDay endDt : ', endDt);
    if(endDt !=null) {
        // 현재날짜
        var dt = new Date();
        var nowYear = dt.getFullYear();
        var nowMonth = (dt.getMonth() + 1) > 9 ? '' + (dt.getMonth() + 1) : '0' + (dt.getMonth() + 1);
        var nowDay = dt.getDate() > 9 ? '' + dt.getDate() : '0' + dt.getDate();
        var nowDate = nowYear.toString() + "" + nowMonth.toString() + "" + nowDay.toString();

        //var startDate = new Date(startDt.substr(0,4), startDt.substr(4,2)-1, startDt.substr(6,2));
        var endDate = new Date(endDt.substr(0, 4), endDt.substr(4, 2), endDt.substr(6, 2));
        var nDate = new Date(nowDate.substr(0, 4), nowDate.substr(4, 2), nowDate.substr(6, 2));
//console.log('endDate : ', endDate + '\n');
//console.log('nDate : ', nDate + '\n');

        var interval = endDate - nDate;

        //var remainYear = parseInt(interval / year);
        //var remainMonth = parseInt(interval / month);
        remainDay = parseInt(interval / day);
    } else {
        remainDay = 0;
    }
//console.log('fncRemainDay : ', remainDay + ' !!!!!!!!! \n');

    return remainDay;
}

/**
 * 잔여 월수 계산 함수.
 * @param endDt
 * @returns {Number}
 */
function fncRemainMonth(endDt) {
    var day = 1000 * 60 * 60 * 24;
    var month = day * 30;
    var year = month * 12;
    var remainMonth = 0;

    if(endDt != null) {
        // 현재날짜
        var dt = new Date();
        var nowYear = dt.getFullYear();
        var nowMonth = (dt.getMonth() + 1) > 9 ? '' + (dt.getMonth() + 1) : '0' + (dt.getMonth() + 1);
        var nowDay = dt.getDate() > 9 ? '' + dt.getDate() : '0' + dt.getDate();
        var nowDate = nowYear.toString() + "" + nowMonth.toString() + "" + nowDay.toString();

        //var startDate = new Date(startDt.substr(0,4), startDt.substr(4,2)-1, startDt.substr(6,2));
        var endDate = new Date(endDt.substr(0, 4), endDt.substr(4, 2) - 1, endDt.substr(6, 2));
        var nDate = new Date(nowDate.substr(0, 4), nowDate.substr(4, 2) - 1, nowDate.substr(6, 2));

        var interval = endDate - nDate;

        //var remainYear = parseInt(interval / year);
        remainMonth = parseInt(interval / month);
        //var remainDay = parseInt(interval / day);
    }

    return remainMonth;
}

/**
 * SET DATEFORMAT
 * @param date
 * @param sep
 * @returns {*}
 */
function setDateFormat(date, sep) {
    var retDate = "";
    if(date.length == 8) {
        var year = date.substr(0,4);
//console.log('year : ', year);
        var month = date.substr(4,2);
//console.log('month : ', month);
        var day = date.substr(6,2);
//console.log('day : ', day);
        if(sep == null) {
            sep = ".";
        }
        retDate = year + sep + month + sep + day;
        return retDate;
    } else {
        return date;
    }
}
var prvUseTermDays = 0;
var productType = "";
var productPrice = 0;
var productDiscPrice = 0;
var productImage = "";
var cateNm = "";
var cateNo = "";
if(rList.length > 0) {
    rList.forEach(function(item, index) {
        productType = item.pType;
        productPrice = item.pPrice;
        productDiscPrice = item.pDiscPrice;
        productImage = item.pImage
        cateNm = item.cateNm;
        cateNo = item.cateNo;
        //console.log('productType = ', productType + '\n');
    });
} // end rList
%>
<!-- 레이어 팝업 부분 -->
<div class="setDiv">
    <div class="mask"></div>
    <div class="window">
        <div style="padding-top: 20px;"><h3>장바구니에 상품을 담았습니다.</h3></div>
        <!--////---서비스이용내역 끝///////-->
        <div>
            <a href="/" id="moveProductBtn" class="btn" target="_parent">쇼핑 계속하기</a>
            <a href="/purchase/paypopup" id="movePayBtn" class="btn" target="_parent">장바구니 가기</a>
        </div>
    </div>
</div>
<!-- 레이어 팝업 부분 -->
<!----- 구매하기 시작  ----->
<div id="start">
    <div class="container">
        <div class="product-detail">

            <!-- 신규 서비스 시작 -->
            <form id="frm0" name="frm0" method="post">
                <input type="hidden" id="pCode0" name="pCode0" value=""/>
                <input type="hidden" id="pUniqCode0" name="pUniqCode0" value=""/>
                <input type="hidden" id="pDiv0" name="pDiv0" value=""/>
                <input type="hidden" id="pPairCodeYn0" name="pPairCodeYn0" value=""/>
                <input type="hidden" id="pPairCode0" name="pPairCode0" value=""/>
                <input type="hidden" id="pDisCountPrice" name="pDisCountPrice" value="<%=productDiscPrice%>"/>

                <!--상품 이미지 -->
                <div class="col-lg-4 col-md-3 col-sm-3 col-xs-12 col-detail">
                    <div class="thumb"><img src="/images/product/<%=productImage%>"></div>
                </div>
                <!--상품 이미지 끝-->

                <!--1. 구매 서비스 선택 시작 -->
                <div class="col-lg-8 col-md-9 col-sm-9 col-xs-12 col-detail">
                    <h3><%if(productType=="SVC") {%>서비스<%} else {%>상품<%}%> 선택</h3>
                    <dl>
                        <dt>할인가: <span class="orange"><%=fnComma(productDiscPrice)%></span>원</dt>
                        <dd>소비자가: <span class="original"><%=fnComma(productPrice)%></span>원</dd>
                        <dd>결제수단: 무통장입금</dd>
                        <dd>배송방법: 입금확인 후 SMS문자</dd>
                        <dd><span class="small black">* 문자로 발송 받은 상품번호가 노출 되지 않도록 주의 바랍니다.</span></dd>
                    </dl>

                    <h4>필수선택</h4>
                    <table id="allTbl1" border="0" cellspacing="0" width="100%" class="table_style3">
                        <thead>
                        <tr>
                            <th><%if(productType=="SVC") {%>서비스<%} else {%>상품<%}%>명</th>
                            <th><%if(productType=="SVC") {%>서비스<%} else {%>상품<%}%>가격</th>
                            <th><%if(productType=="SVC") {%>서비스<%} else {%>상품<%}%>설명</th>
                            <%  if(productType=="HDW") {%>
                            <th>개수</th>
                            <%
                            }
                            %>
                            <th>선택</th>
                        </tr>
                        </thead>
                        <tbody id="tList0">
                        <%
                        if(rList.length > 0) {
                        rList.forEach(function(item, index) {
                        %>
                        <tr>
                            <td><%=item.pNm%><input type="hidden" id="0pUniqCode<%=index%>" name="0pUniqCode" value="<%=item.pUniqCode%>"/></td>
                            <td><%=fnComma(item.pPrice)%> 원<input type="hidden" id="0pCode<%=index%>" name="0pCode" value="<%=item.pCode%>"/></td>
                            <td><%=item.pSmmry%></td>
                            <%
                            if(item.pType=="HDW") {
                            %>
                            <td>
                                <select id="pCount" name="pCount">
                                    <option value="">선택하세요.</option>
                                    <%
                                    for(var x=0; x < item.pStockCount; x++) {
                                    %>
                                    <option value="<%=x+1%>" <%if(x+1=='1'){%>selected<%}%>><%=x+1%></option>
                                    <%
                                    }
                                    %>
                                </select>
                            </td>
                            <%
                            }
                            %>
                            <td>
                                <input type="button" id="0btn<%=index%>" name="0btn" class="btn btn-small-grey btn-orange"value="선택"/>
                            </td>
                        </tr>
                        <%
                        });
                        } // end rList
                        %>
                        </tbody>
                    </table>

            </form>
            <!-- 신규 서비스 시작 -->
            <form id="frm1" name="frm1" method="post">
                <input type="hidden" id="pCode" name="pCode" value=""/>
                <input type="hidden" id="pUniqCode" name="pUniqCode" value=""/>
                <input type="hidden" id="pDiv" name="pDiv" value=""/>
                <input type="hidden" id="pPairCodeYn" name="pPairCodeYn" value=""/>
                <input type="hidden" id="pPairCode" name="pPairCode" value=""/>
                <input type="hidden" id="optSelectedYn" name="optSelectedYn" value=""/>
                <!--1. 구매 서비스 선택 시작 -->

                    <h4>옵션 선택</h4>
                    <table id="allTbl1" border="0" cellspacing="0" width="100%" class="table_style3">
                        <thead>
                        <tr>
                            <th>옵션 명</th>
                            <th>옵션 가격</th>
                            <th>옵션 설명</th>
                            <th>선택</th>
                        </tr>
                        </thead>
                        <tbody id="tList1">
                        <%
                        if(rList1.length > 0) {
                        rList1.forEach(function(item, index) {
                        %>
                        <tr>
                            <td><%=item.pNm%><input type="hidden" id="1pUniqCode<%=index%>" name="1pUniqCode" value="<%=item.pUniqCode%>"/></td>
                            <td><%=fnComma(item.pPrice)%> 원</td>
                            <td><%=item.pDesc%>
                                <input type="hidden" id="1pCode<%=index%>" name="1pCode" value="<%=item.pCode%>"/>
                                <input type="hidden" id="1pPairCodeYn<%=index%>" name="1pPairCodeYn" value="<%=item.pPairCodeYn%>"/>
                                <input type="hidden" id="1pPairCode<%=index%>" name="1pPairCode" value="<%=item.pPairCode%>"/>
                                <input type="hidden" id="1pDiv<%=index%>" name="1pDiv" value="<%=item.pDiv%>"/>
                            </td>
                            <td>
                                <input type="button" id="1btn<%=index%>" name="1btn" class="btn btn-small-grey" value="선택"/>
                            </td>
                        </tr>
                        <%
                        });
                        } // end rList1
                        %>
                        </tbody>
                    </table>
            </form>
            <form id="frm2" name="frm2" method="post">
                <input type="hidden" id="productCode" name="productCode" value="<%=productCode%>"/>
                <input type="hidden" id="productUniqCode" name="productUniqCode" value="<%=productUniqCode%>"/>
                <input type="hidden" id="productDiv" name="productDiv" value=""/>
                <input type="hidden" id="productPairCodeYn" name="productPairCodeYn" value=""/>
                <input type="hidden" id="productPairCode" name="productPairCode" value=""/>
                <input type="hidden" id="productType" name="productType" value="<%=productType%>"/>
                <input type="hidden" id="cmpltYn" name="cmpltYn" value=""/>
                <input type="hidden" id="prevOrderNo" name="prevOrderNo" value=""/>
                <input type="hidden" id="useTermDays" name="useTermDays" value=""/>
                <input type="hidden" id="remainDays" name="remainDays" value=""/>
                <input type="hidden" id="usedDays" name="usedDays" value=""/>
                <input type="hidden" id="remainPrice" name="remainPrice" value=""/>
                <input type="hidden" id="subtractPrice" name="subtractPrice" value=""/>
                <input type="hidden" id="dcntPercent" name="dcntPercent" value=""/>
                <input type="hidden" id="categoryNo" name="categoryNo" value="<%=cateNo%>"/>
                <!--1. 게임 정보 입력 부분 -->
<% if(cateNm == "온라인게임" || cateNm == "구글/카카오게임") { %>
                <h4>게임정보 <span class="small black">(게임에 접속하실 때 쓰는 부분입니다.)</span></h4>
                <table id="allTbl2" border="0" cellspacing="0" width="100%" class="table_style3">
                    <colgroup>
                        <col width="22%">
                        <col>
                    </colgroup>
                    <tbody id="tList3">
                        <tr>
                            <th class="right pdr14"><label for="">계정선택</label></th>
                            <td class="left">
                                <div class="dispinline">
                                <input type="radio" id="googleID" name="idType" value="google" /><label for="googleID"><span><span></span></span><img src="/images/logo-google.png" height="18px"> 구글&nbsp;</label>
                                <input type="radio" id="kakaoID" name="idType" value="kakao" /><label for="kakaoID"><span><span></span></span><img src="/images/logo-kakao.jpg" height="18px"> 카카오&nbsp;</label>
                                <input type="radio" id="naverID" name="idType" value="naver"/><label for="naverID"><span><span></span></span><img src="/images/logo-naver.png" height="18px"> 네이버&nbsp;</label>
                                <input type="radio" id="faceBookID" name="idType" value="facebook"/><label for="faceBookID"><span><span></span></span><img src="/images/logo-facebook.png" height="18px"> 페이스북&nbsp;</label>
                                <input type="radio" id="ncID" name="idType" value="ncsoft"/><label for="ncID"><span><span></span></span><img src="/images/logo-ncsoft.jpg" height="18px">엔씨소프트</label>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th class="right pdr14"><label for="">게임계정</label></th>
                            <td class="left pdl10"><input type="text" id="gameUsrId" name="gameUsrId" value="" class="with-border"/></td>
                        </tr>
                        <tr>
                            <th class="right pdr14"><label for="">비밀번호</label></th>
                            <td class="left pdl10"><input type="text" id="gameUsrPwd1" name="gameUsrPwd1" value="" class="with-border"/></td>
                        </tr>
                        <tr>
                            <th class="right pdr14"><label for="">비밀번호 확인</label></th>
                            <td class="left pdl10"><input type="text" id="gameUsrPwd2" name="gameUsrPwd2" value="" class="with-border"/></td>
                        </tr>
                    </tbody>
                </table>
                <!--1. 게임 정보 입력 부분 -->
                <!--1. 게임 추가 정보 입력 부분 -->
                <h4>추가 정보</h4>
                <table id="allTbl3" border="0" cellspacing="0" width="100%" class="table_style3">
                    <colgroup>
                        <col width="22%">
                        <col>
                    </colgroup>
                    <tbody id="tList4">
                    <tr>
                        <th class="right pdr14"><label for="gameCharNm">케릭명 / 케릭</label></th>
                        <td class="left pdl10"><input type="text" id="gameCharNm" name="gameCharNm" value="" class="with-border" placeholder="케릭명 / 케릭"/></td>
                    </tr>
                    <tr>
                        <th class="right pdr14"><label for="gameLevelServer">레벨 / 서버</label></th>
                        <td class="left pdl10"><input type="text" id="gameLevelServer" name="gameLevelServer" value="" class="with-border" placeholder="레벨 / 서버(* 서버가 있는 게임만 작성해주세요)"/></td>
                    </tr>
                    <tr>
                        <th class="right pdr14"><label for="gameEtc">요청사항</label></th>
                        <td class="left pdl10"><input type="text" id="gameEtc" name="gameEtc" value="" class="with-border"/></td>
                    </tr>
                    </tbody>
                </table>
                <!--1. 게임 추가 정보 입력 부분 -->
<%
    }
    if(cateNm == "구글기프트카드") {
%>
                <!--1. 구글카드인 경우 -->
                <h4>코드를 받으실 방법</h4>
                <table id="allTbl4" border="0" cellspacing="0" width="100%" class="table_style3">
                    <colgroup>
                        <col width="22%">
                        <col>
                    </colgroup>
                    <tbody id="tList5">
                    <tr>
                        <th class="right pdr14"><label for="codeType">선택</label></th>
                        <td class="left">
                            <div class="dispinline">
                                <input type="radio" id="kakaoType" name="codeType" value="kakao"/>
                                    <label for="kakaoType"><span><span></span></span>카카오&nbsp;</label>
                                <input type="radio" id="emailType" name="codeType" value="email"/>
                                    <label for="emailType"><span><span></span></span>이메일&nbsp;</label>
                                <input type="radio" id="mobileType" name="codeType" value="mobile"/>
                                    <label for="mobileType"><span><span></span></span>연락처&nbsp;</label>
                                <input type="radio" id="etcType" name="codeType" value="etc"/>
                                    <label for="etcType"><span><span></span></span>기타</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th class="right pdr14"><label for="gameText"><span id="textLevel">카카오톡</span></label></th>
                        <td class="left pdl10"><input type="text" id="gameText" name="gameText" value="" class="with-border"/></td>
                    </tr>
                    </tbody>
                </table>
                <!-- 구글 카드인 경우 -->
<%
    }
    if(cateNm == "아프리카별풍선") {
%>
                <!--1. 아프리카별풍선 정보 입력 부분 -->
                <h4>아프리카별풍선 정보</h4>
                <table id="allTbl5" border="0" cellspacing="0" width="100%" class="table_style3">
                    <colgroup>
                        <col width="22%">
                        <col>
                    </colgroup>
                    <tbody id="tList6">
                    <tr>
                        <th class="right pdr14"><label for="starId">아프리카 계정 아이디</label></th>
                        <td class="left pdl10"><input type="text" id="starId" name="starId" value="" class="with-border"/></td>
                    </tr>
                    <tr>
                        <th class="right pdr14"><label for="starPwd">계정 비밀번호</label></th>
                        <td class="left pdl10"><input type="text" id="starPwd1" name="starPwd1" value="" class="with-border"/></td>
                    </tr>
                    <tr>
                        <th class="right pdr14"><label for="starPwd2">계정 비밀번호 확인</label></th>
                        <td class="left pdl10"><input type="text" id="starPwd2" name="starPwd2" value="" class="with-border"/></td>
                    </tr>
                    </tbody>
                </table>
                <!--1. 아프리카별풍선 정보 입력 부분 -->
<% } %>
                <!--1. 장바구니 시작 -->
                    <h4>장바구니 추가</h4>

                    <table id="allTbl2" border="0" cellspacing="0" width="100%" class="table_style3 bd">
                        <colgroup>
                            <col width="22%">
                            <col width="10%">
                            <col>
                            <%
                            if(productType=="HDW") {
                            %>
                            <col width="8%">
                            <%
                            }
                            %>
                            <col width="20%">
                            <col width="8%">
                        </colgroup>
                        <thead>
                        <tr>
                            <th><%if(productType=="SVC") {%>서비스<%} else {%>상품<%}%>번호</th>
                            <th><%if(productType=="SVC") {%>서비스<%} else {%>상품<%}%>구분</th>
                            <th><%if(productType=="SVC") {%>서비스<%} else {%>상품<%}%>명</th>
                            <%
                            if(productType=="HDW") {
                            %>
                            <th>개수</th>
                            <%
                            }
                            %>
                            <th><%if(productType=="SVC") {%>서비스<%} else {%>상품<%}%>가격</th>
                            <th><input type="image" id="cartAllDelBtn" name="cartAllDelBtn" src="/images/remove.png" class="remove" vlaue="삭제"/></th>
                        </tr>
                        </thead>
                        <tbody id="tList2">
                        <%
                        if(rList2.length > 0) {
                        rList2.forEach(function(item, index2) {
                        if(item.pDiv == "M") {
                        %>
                        <tr>
                            <td colspan="<%if(item.pType=="HDW") {%>6<%} else {%>5<%}%>" class="pdno">
                                <!-- -->
                                <table border="0" cellspacing="0" width="100%" class="table_style0 bgc2 bbno">
                                    <colgroup>
                                        <col width="22%">
                                        <col width="10%">
                                        <col>
                                        <%
                                        if(productType=="HDW") {
                                        %>
                                        <col width="8%">
                                        <%
                                        }
                                        %>
                                        <col width="20%">
                                        <col width="8%">
                                    </colgroup>
                                    <%
                                    }
                                    %>
                                    <tr>
                                        <td><%=item.pCode%><input type="hidden" id="2pCode<%=index2%>" name="2pCode" value="<%=item.pCode%>"/></td>
                                        <td><%=item.pDivNm%><input type="hidden" id="2pDiv<%=index2%>" name="2pDiv" value="<%=item.pDiv%>"/></td>
                                        <td><%=item.pNm%><input type="hidden" id="2pUniqCode<%=index2%>" name="2pUniqCode" value="<%=item.pUniqCode%>"/></td>
                                        <%
                                        if(productType=="HDW") {
                                        %>
                                        <td><%=item.pCount%><input type="hidden" id="2pCount<%=index2%>" name="2pCount" value="<%=item.pCount%>"/></td>
                                        <%
                                        }
                                        %>
                                        <td><%=fnComma(item.pPrice)%> 원
                                            <input type="hidden" id="2pPrice<%=index2%>" name="2pPrice" value="<%=item.pPrice%>"/>
                                            <input type="hidden" id="2pPairCodeYn<%=index2%>" name="2pPairCodeYn" value="<%=item.pPairCodeYn%>"/>
                                            <input type="hidden" id="2pPairCode<%=index2%>" name="2pPairCode" value="<%=item.pPairCode%>"/>
                                            <input type="hidden" id="2pPoptCnt<%=index2%>" name="2pPoptCnt" value="<%=item.optCnt%>"/>
                                        </td>
                                        <td>
                                            <input type="image" id="delBtn<%=index2%>" name="delBtn" src="/images/remove.png" class="remove" value="삭제"/>
                                        </td>
                                    </tr>
                                    <%
                                    if(item.pDiv == "M") {
                                    %>
                                </table>
                                <!-- -->
                            </td>
                        </tr>
                        <%
                        }
                        });
                        } // end rList2
                        %>
                        </tbody>
                        <%
                        if(productType == "SVC") {
                        %>
                        <tr>
                            <th colspan="5">이용기간</th>
                        </tr>
                        <tr>
                            <td colspan="5" class="left bbdno">
                                <input type="radio" id="termDays30" name="termDays" value="30" <%if(termDays=="30") {%>checked<%}%>/><label id="30" for="termDays30" class="payment"><span><span></span></span>30일</label>
                                <!--
                                <input type="radio" id="termDays360" name="termDays" value="360" <%if(termDays=="360") {%>checked<%}%>/><label id="360" for="termDays360" class="payment"><span><span></span></span>360일</label>
    -->
                            </td>
                        </tr>
                        <%
                        }
                        %>
                        <tr>
                            <td colspan="<%if(productType=="HDW") {%>6<%} else {%>5<%}%>" class="pdt10 pdno bbdno">
                                <!--결제 금액 <input type="text" id="calPayPrice" name="calPayPrice" value="" class="size13hh"readonly/> -
                    잔액 금액 <input type="text" id="calRemainPrice" name="calRemainPrice" value="<%//=price!=null ? fnComma(price) : 0%>" class="size13hh"readonly/> =
                    결제예정금액 <input type="text" id="calPrice" name="calPrice" value="" class="size13hh"readonly/>-->
                                <div class="service-detail">
                                    <div class="wid93">
                                        <div class="wid33">
                                            <div class="wid33in">
                                                <h3>상품 금액</h3>
                                                <p>총금액:<input type="text" id="calPayPrice" name="calPayPrice" value="<%=price!=null ? fnComma(price) : 0%>" class="size7h" readonly/><span class="small">원</span></p>
                                                <%
                                                if(productType == "HDW") {
                                                %>
                                                <p>수량 : <input type="text" id="pCnt" name="pCnt" value=""/></p>
                                                <%
                                                }
                                                %>

                                            </div>
                                        </div>
                                        <div class="dispno orna"><img src="/images/minus.png" width="24px"></div>
                                        <div class="wid33">
                                            <div class="wid33in">
                                                <h3>할인금액</h3>
                                                <p>할인금액:<input type="text" id="discPrice" name="discPrice" value="0" class="size6h" readonly/><span class="small">원</span></p>
                                                <!--<p class="sub">정산 금액:<input type="text" id="calRemainPrice" name="calRemainPrice" value="0" class="size7h" readonly/><span class="small">원</span></p>-->
                                                <p><input type="hidden" id="disCountPct" name="disCountPct" value="0"/></p>
                                                <!--
                                                                                                                        <p>할인율:<input type="text" id="disCountPct" name="disCountPct" value="0" class="size6h" readonly/><span class="small">%</span></p>

                                                                                                                        <p class="sub">자료실<input type="text" id="" name="" value="100" class="size2"readonly/>%할인:<input type="text" id="" name="" value="3,870" class="size6h"readonly/>원</p>
                                                                                                                        <p class="sub">원격지원<input type="text" id="" name="" value="10" class="size2"readonly/>%할인:<input type="text" id="" name="" value="870,000" class="size6h"readonly/>원</p>
                                                -->
                                            </div>
                                        </div>
                                        <div class="dispno orna2"><img src="/images/equal.png" width="24px"></div>
                                        <div class="wid33">
                                            <div class="wid33in">
                                                <h3>결제예정금액</h3>
                                                <p><span class="pricetext"><input type="text" id="totalCalPayPrice" name="totalCalPayPrice" value="<%=price!=null ? fnComma(price) : 0%>" class="size13hh" readonly/></span>원</p>
                                                <p id="basePayPart" style="display:none;">(<span class="sub"><input type="text" id="baseCalPayPrice" name="baseCalPayPrice" value="<%=price!=null ? fnComma(price) : 0%>" class="size6h" readonly/></span>원)</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table><!--상품 정보 및 옵션 선택 끝--->

                <div class="clearfix"></div>

                <!--결제예정금액 확인 및 장바구니/바로구매 버튼-->
                <h4 class="text-right">결제예정금액:<span class="pricetext"><input type="text" id="totalCalPayPrice2" name="totalCalPayPrice2" value="<%=price!=null ? fnComma(price) : 0%>" class="price size13hh" readonly/></span>원</h4>

                <div class="mt30 mb10 text-right">
<!--
                    <a href="#" id="moveBtn" class="btn btn-grey">바로결제하기</a>
-->
                    <a href="#" id="saveBtn" class="btn btn-warning btn-wide"><i class="fa fa-cart-arrow-down font16"></i>&nbsp; 장바구니담기</a>
                </div>
                <!--결제</div>예정금액 확인 및 장바구니/바로구매 버튼 끝-->

            </form>

                </div><!--col-lg--8-->


            <!--상품 상세페이지 하단- 상세정보 시작-->
            <div class="col-lg-12 col-xs-12 detail-page">
                상품정보가 있을때는 감싼 detail-page 살아있게 하고 상품상세페이지가 없을때는 detail-pag 안 보이게
            </div>
            <!--상품 상세페이지 하단- 상세정보 끝-->


        </div><!--product-detail-->
    </div><!--container-->
</div><!--start-->

<!-- jQuery -->
<script src="/js/jquery-1.11.3.min.js"></script>
<!-- jQuery Easing -->
<script src="/js/jquery.easing.1.3.js"></script>
<!-- Bootstrap -->
<script src="/js/bootstrap.min.js"></script>
<!-- Waypoints -->
<script src="/js/jquery.waypoints.min.js"></script>
<!-- countTo -->
<script src="/js/jquery.countTo.js"></script>
<!-- Magnific Popup -->
<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/magnific-popup-options.js"></script>
<!-- Main -->
<script src="/js/main.js"></script>
<!-- scripts -->
<script type="text/javascript">
// 상품 카테고리명 설정.
var productCateNm = "<%=cateNm%>";
    $(function() {
        var usrId = '<%=session.usrId !=null ? session.usrId : ''%>';
        var prevUseTermDays = '<%=prvUseTermDays%>';
        var productType = '<%=productType%>';

        // 계산 모듈.
        var ajaxCalculate = function() {
            var pCode = []; var pDiv = []; var pUniqCode = []; var pPrice = []; var pOptCnt = [];
            var termDays = $("input:radio[name='termDays']:checked").val();
            var selectedPcount = $("#pCount option:selected").val();
            var prvRemainPrice = 0; var pDisCountPrice = 0;

            // 잔여금액 셋팅.
            if($("#sList0").length > 0) {
                prvRemainPrice = $("#prvRemainPrice").val() !='' ? $("#prvRemainPrice").val() : 0;
                prvRemainPrice = unComma(prvRemainPrice);
            }

            if($("#tList2 > tr").length > 0) {
                $("#tList2 > tr").each(function(idx) {
                    pCode[idx] = $("#2pCode"+idx).val();
                    pDiv[idx] = $("#2pDiv"+idx).val();
                    pUniqCode[idx] = $("#2pUniqCode"+idx).val();
                    pPrice[idx] = $("#2pPrice"+idx).val();
                    pOptCnt[idx] = $("#2pPoptCnt"+idx).val();
                    pDisCountPrice = $("#pDisCountPrice").val();
                });
                $.ajax({
                    url : "/purchase/calculate",
                    type : "post",
                    dataType : "json",
                    data : { 'pCode' : pCode, 'pDiv' : pDiv, 'pUniqCode' : pUniqCode, 'pPrice' : pPrice,
                        'pDisCountPrice' : pDisCountPrice, 'pOptCnt' : pOptCnt, 'prvRemainPrice' : prvRemainPrice,
                        'termDays' : termDays, 'pCount' : selectedPcount, 'productType' : productType, 'pCodeCnt' : pCode.length
                    },
                    success : function(data) {
                        // tList\2에 리스트 출력.
                        // 총 금액
                        $("#calPayPrice").val(comma(data.totalCalPrice));
                        // 잔여 금액 셋팅.
                        $("#calRemainPrice").val(comma(data.prvRemainPrice));
                        // 할인금액
                        $("#discPrice").val(comma(data.disCountPrice));
                        // 결정예정금액
                        $("#totalCalPayPrice").val(comma(data.calPayPrice));
                        $("#totalCalPayPrice2").val(comma(data.calPayPrice));
                        if(parseInt(data.baseCalPayPrice) < 0) {
                            $("#basePayPart").css("display","inline");
                            // 원 결정예정금액
                            $("#baseCalPayPrice").val(comma(data.baseCalPayPrice));
                        } else {
                            $("#basePayPart").css("display","none");
                            // 원 결정예정금액
                            $("#baseCalPayPrice").val(comma(data.baseCalPayPrice));
                        }
                        // 할인율
                        $("#disCountPct").val(data.disCountPct);
                        // 정산결과가 0인 체크 셋팅.
                        $("#cmpltYn").val(data.cmpltYn);
                        // 하드웨어 인 경우, 처리.
                        if(data.pType=="HDW") {
                            $("#pCnt").val(data.pCnt !=null ? data.pCnt : 0);
                        }
                    },
                    error : function(err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                });
            } else {
                // 총 금액
                $("#calPayPrice").val(0);
                // 잔여 금액 셋팅.
                $("#calRemainPrice").val(0);
                // 할인금액
                $("#discPrice").val(0);
                // 결정예정금액
                $("#totalCalPayPrice").val(0);
                // 결정예정금액
                $("#totalCalPayPrice2").val(0);
                // 원 결정예정금액
                $("#baseCalPayPrice").val(0);
                // 할인율
                $("#disCountPct").val(0);
                // 정산결과가 0인 체크 셋팅.
                $("#cmpltYn").val('N');
                if(productType=="HDW") {
                    // 수량 셋팅.
                    $("#pCnt").val(0);
                }
            }
        };

        // 계산 모듈.
        var ajaxPayCalculate = function() {
            var pCode = []; var pDiv = []; var pUniqCode = []; var pPrice = []; var pOptCnt = [];
            var termDays = $("input:radio[name='termDays']:checked").val();
            var selectedPcount = $("#pCount option:selected").val();
            var prvRemainPrice = 0;

            // 잔여금액 셋팅.
            if($("#sList0").length > 0) {
                prvRemainPrice = $("#prvRemainPrice").val() !='' ? $("#prvRemainPrice").val() : 0;
                prvRemainPrice = unComma(prvRemainPrice);
            }

            if($("#tList3 > tr").length > 0) {
                $("#tList3 > tr").each(function(idx) {
                    pCode[idx] = $("#3pPcode"+idx).val();
                    pDiv[idx] = $("#3pDiv"+idx).val();
                    pUniqCode[idx] = $("#3pUniqCode"+idx).val();
                    pPrice[idx] = $("#3pPrice"+idx).val();
                    pOptCnt[idx] = $("#3pPoptCnt"+idx).val();
                });
                $.ajax({
                    url : "/purchase/calculate",
                    type : "post",
                    dataType : "json",
                    data : { 'pCode' : pCode, 'pDiv' : pDiv, 'pUniqCode' : pUniqCode, 'pPrice' : pPrice,
                        'pOptCnt' : pOptCnt, 'prvRemainPrice' : prvRemainPrice, 'termDays' : termDays,
                        'pCount' : selectedPcount, 'productType' : productType, 'pCodeCnt' : pCode.length
                    },
                    success : function(data) {
                        // tList3에 리스트 출력.
                        // 결정예정금액
                        $("#totalPayPrice").val(comma(data.calPayPrice));
                        if(data.pType=="HDW") {
                            $("#pCnt").val(data.pCnt !=null ? data.pCnt : 0);
                        }

                    },
                    error : function(err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                });
            } else {
                // 결정예정금액
                $("#totalPayPrice").val(0);
                if(productType=="HDW") {
                    // 수량 셋팅.
                    $("#pCnt").val(0);
                }
            }
        };
        // 옵션 서비스 선택 화면 초기화 함수.
        var reload1 = function() {
            // 옵션 리스트
            $("#tList1 > tr").each(function(idx) {

                // 버튼 셋팅.
                if($("#1pCode"+idx).val() == "APP170109ASS3") {
                    //$("#1btn"+idx).css("display", "none");
                }

                // 장바구니 리스트 체크.
                if($("#tList2 > tr").length > 0) {
                    $("#tList2 > tr").each(function(idx2) {
                        if($("#2pCode"+idx2).val()=="APP170109ASS2") {
                            if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                $("#1btn" + idx).css("display", "inline-block");
                            }
                        }
                    });
                }


                // 버튼 비/활성화 처리.
                if($("#sList0").length > 0) {
//console.log('test!');
                    var arrPrvCode = [];
                    var arrPayResult = [];
                    $("#sList0 > tr").each(function(idx3) {
                        //arrPrvCode[idx3] = $("#prvPcode"+idx3).val();
                        //arrPayResult[idx3] = $("#prevPayResult"+idx3).val();
//console.log('$("#1pCode"+idx).val()', $("#1pCode"+idx).val());
//console.log('$("#prvPcode"+idx3).val()', $("#prvPcode"+idx3).val());
                        if($("#1pCode"+idx).val()==$("#prvPcode"+idx3).val() && $("#prvDiv"+idx3).val() == "옵션") {
//console.log('true');
                            if($("#prevPayResult"+idx3).val()!="paid") {
                                $("#1btn"+idx).css("display", "none");
                            }
                        }
                    });

                }


                // 선택버튼 이벤트 처리.
                $("#1btn"+idx).on("click", function(e) {
                    console.log('1pCode['+idx+'] : ', $("#1pCode"+idx).val());
                    console.log('1pUniqCode['+idx+'] : ', $.trim($("#1pUniqCode"+idx).val()));
                    console.log('1pPairCodeYn['+idx+'] : ', $.trim($("#1pPairCodeYn"+idx).val()));
                    console.log('1pPairCode['+idx+'] : ', $.trim($("#1pPairCode"+idx).val()));
//console.log('usrId : ', usrId);

                    e.preventDefault();

                    if(usrId == '') {
                        alert('로그인 하세요.');
                        return false;
                    }

                    // 상품갯수
                    var selectedPcount = "0";
                    if(productType=="HDW") {
                        selectedPcount = $("#pCount option:selected").val();
                        if(selectedPcount == "") {
                            alert("상품 갯수를 선택하여 주세요.");
                            $("#pCount").focus();
                            return;
                        }
                    }

                    // 로그분석및 진단지원 서비스 선택한 경우 처리.
                    var optSelectedYn = "N";
                    if($("#1pCode"+idx).val() == "APP170109ASS2") {
                        optSelectedYn = "Y";
                    }

                    $("#pCode").val($("#1pCode"+idx).val());
                    $("#pUniqCode").val($.trim($("#1pUniqCode"+idx).val()));
                    $("#pPairCodeYn").val($.trim($("#1pPairCodeYn"+idx).val()));
                    $("#pPairCode").val($.trim($("#1pPairCode"+idx).val()));
                    $("#pDiv").val($.trim($("#1pDiv"+idx).val()));
                    $("#optSelectedYn").val(optSelectedYn);
                    /*
                     $("#frm1").attr("method", "post");
                     $("#frm1").attr("action", "/purchase/cart/save");
                     $("#frm1").submit();
                     */


                    // 조회 처리.
                    $.ajax({
                        url : "/purchase/cart/save",
                        type : "post",
                        dataType : "json",
                        data : {
                            'pCode' : $.trim($("#1pCode"+idx).val()),
                            'pUniqCode' : $.trim($("#1pUniqCode"+idx).val()),
                            'pPairCodeYn' : $.trim($("#1pPairCodeYn"+idx).val()),
                            'pPairCode' : $.trim($("#1pPairCode"+idx).val()),
                            'pDiv' : $.trim($("#1pDiv"+idx).val()),
                            'optSelectedYn' : optSelectedYn,
                            'pCount' : selectedPcount
                        },
                        success : function(data) {
                            // tList2에 리스트 출력.
                            console.log('tList2 cnt : ', data.cnt);
                            var addHTML = "";
                            if(data.cnt > 0) {
                                $("#tList2").html("");
                                var calPrice = 0;
                                $.each(data.list, function(i, item) {
                                    if(item.pDiv=="M") {
                                        if(item.pType=="HDW") {
                                            addHTML += "<tr><td colspan='6' class='pdno'>";
                                            addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                            addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='8%'><col width='20%'><col width='8%'></colgroup>";
                                        } else {
                                            addHTML += "<tr><td colspan='5' class='pdno'>";
                                            addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                            addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='20%'><col width='8%'></colgroup>";
                                        }
                                    }
                                    addHTML += "<tr>";
                                    addHTML += "<td>"+item.pCode+"<input type='hidden' id='2pCode"+i+"' name='2pCode' value='"+item.pCode+"'/></td>";
                                    addHTML += "<td>"+item.pDivNm+"<input type='hidden' id='2pDiv" + i + "' name='2pDiv' value='" + item.pDiv + "'/></td>";
                                    addHTML += "<td>"+item.pNm+"<input type='hidden' id='2pUniqCode"+i+"' name='2pUniqCode' value='"+item.pUniqCode+"'/></td>";
                                    if(item.pType=="HDW") {
                                        addHTML += "<td>" + item.pCount + "</td>";
                                        addHTML += "<td>" + comma(parseInt(item.pPrice) * parseInt(item.pCount));
                                        addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+parseInt(item.pPrice) * parseInt(item.pCount)+"'/>";
                                        addHTML += "<input type='hidden' id='2pCnt"+i+"' name='2pCnt' value='"+item.pCount+"'/>";
                                    } else {
                                        addHTML += "<td>" + comma(item.pPrice);
                                        addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+item.pPrice+"'/>";
                                    }
                                    addHTML += "<input type='hidden' id='2pPairCodeYn"+i+"' name='2pPairCodeYn' value='"+item.pPairCodeYn+"'/>";
                                    addHTML += "<input type='hidden' id='2pPairCode"+i+"' name='2pPairCode' value='"+item.pPairCode+"'/>";
                                    addHTML += "<input type='hidden' id='2pPoptCnt"+i+"' name='2pPoptCnt' value='"+item.optCnt+"'/>";
                                    addHTML += "</td>";
                                    addHTML += "<td><input type='image' id='delBtn" + i + "' name='delBtn' src='/images/remove.png'' class='remove' value='삭제'/></td>";
                                    addHTML += "</tr>";
                                    if(item.pDiv=="M") {
                                        addHTML += "</table></td></tr>";
                                    }

                                    // 총 예상 가격
                                    calPrice += item.pPrice;
                                }); // end each

                                $("#tList2").html(addHTML);
                                $("#totalCalPrice").val(comma(calPrice));

                                // 원격지원 선택버튼 표시 처리.
                                if(data.optSelectedYn == "Y") {

                                    if($("#tList1 > tr").length > 0) {
                                        $("#tList1 > tr").each(function(idx) {
                                            if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                                $("#1btn"+idx).css("display", "inline");
                                            }
                                        });
                                    }
                                }
                            } else {
                                $("#tList2").html(addHTML);
                            }
                            //reload1();
                            reload2();
                            ajaxCalculate();
                        },
                        error : function(err) {
                            alert("errCode : " + JSON.stringify(err));
                        }
                    }); // end ajax


                }); // end 버튼 이벤트
            });
        };

        // 장바구니 리스트 화면 초기화.
        var reload2 = function() {
            // 카트 관련
            $("#tList2 > tr").each(function(idx) {

                // 삭제 버튼 이벤트 처리.
                $("#delBtn"+idx).click(function(e) {
                    e.preventDefault();

                    if(usrId == '') {
                        alert('로그인 하세요.');
                        return false;
                    }

                    console.log('장바구니 삭제 del val['+idx+'] : ', $("#2pCode"+idx).val());
                    console.log('장바구니 삭제 del val['+idx+'] : ', $.trim($("#2pUniqCode"+idx).val()));
                    console.log('optCnt : ', $.trim($("#2pPoptCnt"+idx).val()));

                    // 조회 처리.
                    $.ajax({
                        url : "/purchase/cart/delete",
                        type : "post",
                        dataType : "json",
                        data : {
                            'pCode' : $.trim($("#2pCode"+idx).val()),
                            'pUniqCode' : $.trim($("#2pUniqCode"+idx).val()),
                            'pDiv' : $.trim($("#2pDiv"+idx).val()),
                            'pPairCodeYn' : $.trim($("#2pPairCodeYn"+idx).val()),
                            'pPairCode' : $.trim($("#2pPairCode"+idx).val()),
                        },
                        success : function(data) {
                            // tList2에 리스트 출력.
                            var addHTML = "";
                            if(data.cnt > 0) {
                                $.each(data.list, function (i, item) {
                                    if(item.pDiv=="M") {
                                        addHTML += "<tr><td colspan='5' class='pdno'>";
                                        addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                        addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='20%'><col width='8%'></colgroup>";
                                    }
                                    addHTML += "<tr>";
                                    addHTML += "<td>" + item.pCode + "<input type='hidden' id='2pCode" + i + "' name='2pCode' value='" + item.pCode + "'/></td>";
                                    addHTML += "<td>" + item.pDivNm + "<input type='hidden' id='2pDiv" + i + "' name='2pDiv' value='" + item.pDiv + "'/></td>";
                                    addHTML += "<td>" + item.pNm + "<input type='hidden' id='2pUniqCode" + i + "' name='2pUniqCode' value='" + item.pUniqCode + "'/></td>";
                                    //addHTML += "<td>" + item.pPrice + "<input type='hidden' id='2pPrice" + i + "' name='2pPrice' value='" + item.pPrice + "'/></td>";
                                    if(item.pType=="HDW") {
                                        addHTML += "<td>" + comma(parseInt(item.pPrice) * parseInt(item.pCount)) + "</td>";
                                        addHTML += "<td>" + item.pCount;
                                        addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+parseInt(item.pPrice) * parseInt(item.pCount)+"'/>";
                                        addHTML += "<input type='hidden' id='2pCnt"+i+"' name='2pCnt' value='"+item.pCount+"'/>";
                                        addHTML += "</td>";
                                    } else {
                                        addHTML += "<td>" + comma(item.pPrice);
                                        addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+item.pPrice+"'/>";
                                        addHTML += "</td>";
                                    }
                                    addHTML += "<td><input type='button' id='delBtn" + i + "' name='delBtn' src='/images/remove.png'' class='remove' value='삭제'/>";
                                    addHTML += "<input type='hidden' id='2pPoptCnt" + i + "' name='2pPoptCnt' value='" + item.optCnt + "'/>";
                                    addHTML += "<input type='hidden' id='2pPairCodeYn"+i+"' name='2pPairCodeYn' value='"+item.pPairCodeYn+"'/>";
                                    addHTML += "<input type='hidden' id='2pPairCode"+i+"' name='2pPairCode' value='"+item.pPairCode+"'/>";
                                    addHTML += "</td></tr>";
                                    if(item.pDiv=="M") {
                                        addHTML += "</table></td></tr>";
                                    }

                                    // 선택버튼 활성화.
                                    if(item.pCode=="APP170109ASS2") {
                                        $("#tList1 > tr").each(function(idx) {
                                            if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                                $("#1btn"+idx).css("display","inline");
                                            }
                                        });
                                    } else {
                                        $("#tList1 > tr").each(function(idx) {
                                            if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                                $("#1btn"+idx).css("display","none");
                                            }
                                        });
                                    }

                                });
                                $("#tList2").html(addHTML);
                            } else {
                                $("#tList2").html(addHTML);
                                // 원격지원 버튼 지우기.
                                if($("#tList1 > tr").length > 0) {
                                    $("#tList1 > tr").each(function(idx) {
                                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                            $("#1btn"+idx).css("display", "none");
                                        }
                                    });
                                }
                            }

                            reload2();
                            ajaxCalculate();
                        },
                        error : function(err) {
                            alert("errCode : " + JSON.stringify(err));
                        }
                    });

                });
            });

        };
        // 결제하기 리스트 삭제 이벤트 처리.
        var reload3 = function() {
            // 결제하기 관련
            $("#tList3 > tr").each(function (idx) {

                // 결제 삭제 하기  버튼 이벤트 처리.
                $("#del3Btn" + idx).click(function (e) {
                    e.preventDefault();

                    if (usrId == '') {
                        alert('로그인 하세요.');
                        return false;
                    }

                    console.log('결제 삭제 del val[' + idx + '] : ', $("#3pPcode" + idx).val());
                    console.log('결제 삭제 del val[' + idx + '] : ', $.trim($("#3pUniqCode" + idx).val()));
                    console.log('orderNo : ', $.trim($("#orderNo").val()));

                    // 이용기간 서비스 라디오 버튼 값 취득.
                    var termDays = $("input:radio[name='termDays']:checked").val();

                    $("#pCode3").val($("#3pPcode" + idx).val());
                    $("#pUniqCode3").val($("#3pUniqCode" + idx).val());
                    $("#pDiv3").val($("#3pDiv" + idx).val());
                    $("#pPairCodeYn3").val($("#3pPairCodeYn" + idx).val());
                    $("#pPairCode3").val($("#3pPairCode" + idx).val());

                    var dataValues = {
                        'termDays': termDays,
                        'totalCalPayPrice': $("#totalCalPayPrice").val(),
                        'cmpltYn': $("#cmpltYn").val(),
                        'useTermDays': $("#useTermDays").val(),
                        'pCode3': $("#pCode3").val(),
                        'pUniqCode3': $("#pUniqCode3").val(),
                        'pDiv3': $("#pDiv3").val(),
                        'pPairCodeYn3': $("#pPairCodeYn3").val(),
                        'pPairCode3': $("#pPairCode3").val(),
                        'orderNo' : $("#orderNo").val()
                    };

                    // 조회 처리.
                    $.ajax({
                        url: "/purchase/order/delete",
                        type: "post",
                        dataType: "json",
                        data: dataValues,
                        success: function (data) {
                            // tList3에 리스트 출력.
                            var addHTML = "";
                            if (data.cnt > 0) {
                                $("#tList3").html("");
                                var payPrice = 0;
                                $.each(data.list, function (i, item) {
                                    if (item.pDiv == "M") {
                                        addHTML += "<tr><td colspan='5' class='pdno'>";
                                        addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                        addHTML += "<colgroup><col width='22%'><col width='10%'><col width='26%'><col><col width='15%'></colgroup>";
                                    }
                                    addHTML += "<tr>";
                                    addHTML += "<td>" + item.pCode + "<input type='hidden' id='payOrderNo" + i + "' name='payOrderNo' value='" + item.orderNo + "'/></td>";
                                    addHTML += "<td>" + item.pDivNm + "<input type='hidden' id='3pDiv" + i + "' name='3pDiv' value='" + item.pDiv + "'/></td>";
                                    addHTML += "<td>" + item.pNm + "</td>";
                                    addHTML += "<td>" + comma(item.pPrice) + "<input type='hidden' id='3pPrice" + i + "' name='3pPrice' value='" + item.pPrice + "'/>";
                                    addHTML += "<input type='hidden' id='3pPcode" + i + "' name='3pPcode' value='" + item.pCode + "'/>";
                                    addHTML += "<input type='hidden' id='3pPairCodeYn" + i + "' name='3pPairCodeYn' value='" + item.pPairCodeYn + "'/>";
                                    addHTML += "<input type='hidden' id='3pPairCode" + i + "' name='3pPairCode' value='" + item.pPairCode + "'/>";
                                    addHTML += "<input type='hidden' id='3pUniqCode" + i + "' name='3pUniqCode' value='" + item.pUniqCode + "'/>";
                                    addHTML += "</td>";
                                    addHTML += "<td><input type='image' id='del3Btn" + i + "' name='delBtn' src='/images/remove.png' class='remove' value='삭제'/></td>";
                                    addHTML += "</tr>";
                                    if (item.pDiv == "M") {
                                        addHTML += "</table></td></tr>";
                                    }
                                    /*
                                     if(item.pCode=="APP170109ASS2") {
                                     $("#tList1 > tr").each(function(idx) {
                                     if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                     $("#1btn"+idx).css("display", "inline");
                                     }
                                     });
                                     }
                                     */
                                    // 총 예상 가격
                                    //payPrice += item.totalPrice;
                                });
                                $("#tList3").html(addHTML);

                            } else {
                                $("#tList3").html(addHTML);
                            }
                            reload3();
                            // 계산처리.
                            ajaxPayCalculate();
                        },
                        error: function (err) {
                            alert("errCode : " + JSON.stringify(err));
                        }
                    });


                    //$("#frm3").attr("action","/purchase/order/delete");
                    //$("#frm3").submit();
                });
            });
        };

        // 이용기간 라디오 버튼 셋팅.
        if(prevUseTermDays == '360') {
            $("#360").css("display", "none");
        }

        // 서비스 선택 리스트
        $("#tList0 > tr").each(function(idx) {

            // 선택버튼 이벤트 처리.
            $("#0btn"+idx).on("click", function(e) {
console.log('val['+idx+'] : ', $("#0pCode"+idx).val());
console.log('val['+idx+'] : ', $.trim($("#0pUniqCode"+idx).val()));
                e.preventDefault();

                if(usrId == '') {
                    alert('로그인 하세요.');
                    location.href = "/";
                    return false;
                }

                // 상품갯수
                var selectedPcount = "0";
                if(productType=="HDW") {
                    selectedPcount = $("#pCount option:selected").val();
                    if(selectedPcount == "") {
                        alert("상품 갯수를 선택하여 주세요.");
                        $("#pCount").focus();
                        return;
                    }
                }

                // 유니크코드 셋팅.
                $("#pUniqCode0").val($.trim($("#0pUniqCode"+idx).val()));
                console.log('pUniqCode0 : ', $("#pUniqCode0").val());

                $.ajax({
                    url : "/purchase/cart/save",
                    type : "post",
                    dataType : "json",
                    data : {
                        'pCode': $.trim($("#0pCode" + idx).val()),
                        'pUniqCode': $.trim($("#0pUniqCode" + idx).val()),
                        'pPairCodeYn': '',
                        'pPairCode': '',
                        'optSelectedYn': 'N',
                        'pCount' : selectedPcount
                    },
                    success : function(data) {
                        // tList2에 리스트 출력.
                        console.log('tList2 cnt : ', data.cnt);
                        var addHTML = "";
                        if(data.cnt > 0) {
                            $("#tList2").html("");
                            var calPrice = 0;
                            $.each(data.list, function(i, item) {
                                if(item.pDiv=="M") {
                                    if(item.pType=="HDW") {
                                        addHTML += "<tr><td colspan='6' class='pdno'>";
                                        addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                        addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='8%'><col width='20%'><col width='8%'></colgroup>";
                                    } else {
                                        addHTML += "<tr><td colspan='5' class='pdno'>";
                                        addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                        addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='20%'><col width='8%'></colgroup>";
                                    }
                                }
                                addHTML += "<tr>";
                                addHTML += "<td>"+item.pCode+"<input type='hidden' id='2pCode"+i+"' name='2pCode' value='"+item.pCode+"'/></td>";
                                addHTML += "<td>"+item.pDivNm+"<input type='hidden' id='2pDiv" + i + "' name='2pDiv' value='" + item.pDiv + "'/></td>";
                                addHTML += "<td>"+item.pNm+"<input type='hidden' id='2pUniqCode"+i+"' name='2pUniqCode' value='"+item.pUniqCode+"'/></td>";
                                //addHTML += "<td>"+ comma(item.pPrice);
                                if(item.pType=="HDW") {
                                    addHTML += "<td>" + item.pCount + "</td>";
                                    addHTML += "<td>" + comma(parseInt(item.pPrice) * parseInt(item.pCount));
                                    addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+parseInt(item.pPrice) * parseInt(item.pCount)+"'/>";
                                    addHTML += "<input type='hidden' id='2pCnt"+i+"' name='2pCnt' value='"+item.pCount+"'/>";
                                } else {
                                    addHTML += "<td>" + comma(item.pPrice);
                                    addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+item.pPrice+"'/>";
                                }
                                //addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+item.pPrice+"'/>";
                                addHTML += "<input type='hidden' id='2pPairCodeYn"+i+"' name='2pPairCodeYn' value='"+item.pPairCodeYn+"'/>";
                                addHTML += "<input type='hidden' id='2pPairCode"+i+"' name='2pPairCode' value='"+item.pPairCode+"'/>";
                                addHTML += "<input type='hidden' id='2pPoptCnt"+i+"' name='2pPoptCnt' value='"+item.optCnt+"'/>";
                                addHTML += "</td>";
                                addHTML += "<td><input type='image' id='delBtn" + i + "' name='delBtn' src='/images/remove.png'' class='remove' value='삭제'/></td>";
                                addHTML += "</tr>";
                                if(item.pDiv=="M") {
                                    addHTML += "</table></td></tr>";
                                }

                                // 총 예상 가격
                                calPrice += item.pPrice;
                            });
                            $("#tList2").html(addHTML);
                            $("#totalCalPrice").val(comma(calPrice));

                            // 원격지원 선택버튼 표시 처리.
                            if(data.optSelectedYn == "Y") {

                                if($("#tList1 > tr").length > 0) {
                                    $("#tList1 > tr").each(function(idx) {
                                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                            $("#1btn"+idx).css("display", "inline");
                                        }
                                    });
                                }

                            } else {
                                if($("#tList1 > tr").length > 0) {
                                    $("#tList1 > tr").each(function(idx) {
                                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                            $("#1btn"+idx).css("display", "none");
                                        }
                                    });
                                }
                            }

                        } else {
                            $("#tList2").html(addHTML);
                        }
                        reload2();
                        ajaxCalculate();

                    },
                    error : function(err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                });

                // 조회 처리.
                $.ajax({
                    url : "/purchase/opt",
                    type : "post",
                    dataType : "json",
                    data : { 'pCode' : $.trim($("#0pCode"+idx).val()), 'pUniqCode' : $.trim($("#0pUniqCode"+idx).val()) },
                    success : function(data) {
                        // tList1에 리스트 출력.
                        console.log('cnt : ', data.cnt);
                        var addHTML = "";
                        if(data.cnt > 0) {
                            $("#tList1").html("");
                            var calPrice = 0;
                            $.each(data.list, function(i, item) {
                                addHTML += "<tr>";
                                addHTML += "<td>"+item.pNm+"<input type='hidden' id='1pCode"+i+"' name='1pCode' value='"+item.pCode+"'/></td>";
                                addHTML += "<td>"+ comma(item.pPrice) +"<input type='hidden' id='1pUniqCode"+i+"' name='1pUniqCode' value='"+item.pUniqCode+"'/></td>";
                                addHTML += "<td>"+ item.pDesc +"<input type='hidden' id='1pPairCode"+i+"' name='1pPairCode' value='"+item.pPairCode+"'/><input type='hidden' id='1pPairCodeYn"+i+"' name='1pPairCodeYn' value='"+item.pPairCodeYn+"'/></td>";
                                if(item.pCode=="APP170109ASS3") {
                                    addHTML += "<td><input type='button' id='1btn"+i+"' name='1btn' class='btn btn-small-grey btn-noradius'' value='선택' style='display:none;'/></td>";
                                } else {
                                    addHTML += "<td><input type='button' id='1btn"+i+"' name='1btn' class='btn btn-small-grey btn-noradius'' value='선택'/></td>";
                                }

                                addHTML += "</tr>";
                            });
                            $("#tList1").html(addHTML);
                        } else {
                            $("#tList1").html(addHTML);
                        }
                        reload1();
                    },
                    error : function(err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                });
            });
        });

        // 옵션 리스트
        $("#tList1 > tr").each(function(idx) {

            // 버튼 셋팅.
            if($("#1pCode"+idx).val() == "APP170109ASS3") {
                $("#1btn"+idx).css("display", "none");
            }

            // 장바구니 리스트 체크.
            if($("#tList2 > tr").length > 0) {
                $("#tList2 > tr").each(function(idx2) {
                    if($("#2pCode"+idx2).val()=="APP170109ASS2") {
                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                            $("#1btn" + idx).css("display", "inline-block");
                        }
                    }
                });
            }
            /*
             // 선택 버튼 활성화 처리.
             if($("#tList2 > tr").length > 0) {
             $("#tList2 > tr").each(function (idx2) {
             if ($("#2pCode" + idx2).val() == "APP170109ASS2") {
             $("#tList1 > tr").each(function(idx) {
             if($("#1pCode"+idx).val() == "APP170109ASS3") {
             var addHTML2 = "<input type='button' id='1btn"+idx+"' name='1btn' class='btn btn-small-grey' value='선택'/>";
             $("#tList1 > tr").eq(idx).find("td:eq(3)").html(addHTML2);
             }
             });
             }
             });
             }
             */
            // 버튼 비/활성화 처리.
            if($("#sList0").length > 0) {
                var arrPrvCode = [];
                var arrPayResult = [];
                $("#sList0 > tr").each(function(idx3) {
                    //arrPrvCode[idx3] = $("#prvPcode"+idx3).val();
                    //arrPayResult[idx3] = $("#prevPayResult"+idx3).val();
//console.log('$("#1pCode"+idx).val()', $("#1pCode"+idx).val());
//console.log('$("#prvPcode"+idx3).val()', $("#prvPcode"+idx3).val());
                    if($("#1pCode"+idx).val()==$("#prvPcode"+idx3).val() && $("#prvDiv"+idx3).val() == "옵션") {
//console.log('true');
                        if($("#prevPayResult"+idx3).val()!="paid") {
                            $("#1btn"+idx).css("display", "none");
                        }
                    }
                });
            }

            // 선택버튼 이벤트 처리.
            $("#1btn"+idx).on("click", function(e) {
console.log('1pCode['+idx+'] : ', $("#1pCode"+idx).val());
console.log('1pUniqCode['+idx+'] : ', $.trim($("#1pUniqCode"+idx).val()));
console.log('1pPairCodeYn['+idx+'] : ', $.trim($("#1pPairCodeYn"+idx).val()));
console.log('1pPairCode['+idx+'] : ', $.trim($("#1pPairCode"+idx).val()));
//console.log('usrId : ', usrId);

                e.preventDefault();

                if(usrId == '') {
                    alert('로그인 하세요.');
                    location.href = "/";
                    return false;
                }

                // 상품갯수
                var selectedPcount = "0";
                if(productType=="HDW") {
                    selectedPcount = $("#pCount option:selected").val();
                    if(selectedPcount == "") {
                        alert("상품 갯수를 선택하여 주세요.");
                        $("#pCount").focus();
                        return;
                    }
                }

                // 로그분석및 진단지원 서비스 선택한 경우 처리.
                var optSelectedYn = "N";
                if($("#1pCode"+idx).val() == "APP170109ASS2") {
                    optSelectedYn = "Y";
                }

                $("#pCode").val($("#1pCode"+idx).val());
                $("#pUniqCode").val($.trim($("#1pUniqCode"+idx).val()));
                $("#pPairCodeYn").val($.trim($("#1pPairCodeYn"+idx).val()));
                $("#pPairCode").val($.trim($("#1pPairCode"+idx).val()));
                $("#pDiv").val($.trim($("#1pDiv"+idx).val()));
                $("#optSelectedYn").val(optSelectedYn);

                /*
                 $("#frm1").attr("method", "post");
                 $("#frm1").attr("action", "/purchase/cart/save");
                 $("#frm1").submit();
                 */

                // 조회 처리.
                $.ajax({
                    url : "/purchase/cart/save",
                    type : "post",
                    dataType : "json",
                    data : {
                        'pCode' : $.trim($("#1pCode"+idx).val()),
                        'pUniqCode' : $.trim($("#1pUniqCode"+idx).val()),
                        'pPairCodeYn' : $.trim($("#1pPairCodeYn"+idx).val()),
                        'pPairCode' : $.trim($("#1pPairCode"+idx).val()),
                        'optSelectedYn' : optSelectedYn,
                        'pCount' : selectedPcount
                    },
                    success : function(data) {
                        // tList2에 리스트 출력.
                        console.log('tList2 cnt : ', data.cnt);
                        var addHTML = "";
                        if(data.cnt > 0) {
                            $("#tList2").html("");
                            var calPrice = 0;
                            $.each(data.list, function(i, item) {
                                if(item.pDiv=="M") {
                                    if(item.pType=="HDW") {
                                        addHTML += "<tr><td colspan='6' class='pdno'>";
                                        addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                        addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='8%'><col width='20%'><col width='8%'></colgroup>";
                                    } else {
                                        addHTML += "<tr><td colspan='5' class='pdno'>";
                                        addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                        addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='20%'><col width='8%'></colgroup>";
                                    }
                                }
                                addHTML += "<tr>";
                                addHTML += "<td>"+item.pCode+"<input type='hidden' id='2pCode"+i+"' name='2pCode' value='"+item.pCode+"'/></td>";
                                addHTML += "<td>"+item.pDivNm+"<input type='hidden' id='2pDiv" + i + "' name='2pDiv' value='" + item.pDiv + "'/></td>";
                                addHTML += "<td>"+item.pNm+"<input type='hidden' id='2pUniqCode"+i+"' name='2pUniqCode' value='"+item.pUniqCode+"'/></td>";
                                //addHTML += "<td>"+ comma(item.pPrice);
                                if(item.pType=="HDW") {
                                    addHTML += "<td>" + item.pCount + "</td>";
                                    addHTML += "<td>" + comma(parseInt(item.pPrice) * parseInt(item.pCount));
                                    addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+parseInt(item.pPrice) * parseInt(item.pCount)+"'/>";
                                    addHTML += "<input type='hidden' id='2pCnt"+i+"' name='2pCnt' value='"+item.pCount+"'/>";
                                } else {
                                    addHTML += "<td>" + comma(item.pPrice);
                                    addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+item.pPrice+"'/>";
                                }
                                //addHTML += "<input type='hidden' id='2pPrice"+i+"' name='2pPrice' value='"+item.pPrice+"'/>";
                                addHTML += "<input type='hidden' id='2pPairCodeYn"+i+"' name='2pPairCodeYn' value='"+item.pPairCodeYn+"'/>";
                                addHTML += "<input type='hidden' id='2pPairCode"+i+"' name='2pPairCode' value='"+item.pPairCode+"'/>";
                                addHTML += "<input type='hidden' id='2pPoptCnt"+i+"' name='2pPoptCnt' value='"+item.optCnt+"'/>";
                                addHTML += "</td>";
                                addHTML += "<td><input type='image' id='delBtn" + i + "' name='delBtn' src='/images/remove.png'' class='remove' value='삭제'/></td>";
                                addHTML += "</tr>";
                                if(item.pDiv=="M") {
                                    addHTML += "</table></td></tr>";
                                }

                                // 총 예상 가격
                                calPrice += item.pPrice;
                            });
                            $("#tList2").html(addHTML);
                            $("#totalCalPrice").val(comma(calPrice));

                            // 원격지원 선택버튼 표시 처리.
                            if(data.optSelectedYn == "Y") {

                                if($("#tList1 > tr").length > 0) {
                                    $("#tList1 > tr").each(function(idx) {
                                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                            $("#1btn"+idx).css("display", "inline");
                                        }
                                    });
                                }

                            } else {
                                if($("#tList1 > tr").length > 0) {
                                    $("#tList1 > tr").each(function(idx) {
                                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                            $("#1btn"+idx).css("display", "none");
                                        }
                                    });
                                }
                            }

                        } else {
                            $("#tList2").html(addHTML);
                        }
                        reload1();
                        ajaxCalculate();

                    },
                    error : function(err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                }); // ajax 끝.


            }); // 선택버튼 이벤트 처리 끝.

        }); // 옵션 리스트 끝.

        // 카트(장바구니) 관련
        $("#tList2 > tr").each(function(idx) {

            // 잔여금액 셋팅.
            if($("#sList0").length > 0) {
                var prvRemainPrice = $("#prvRemainPrice").val() !=null ? $("#prvRemainPrice").val() : 0;
                $("#prvRemainPrice").val(comma(prvRemainPrice));
            }
            // 계산 셋팅.
            var calPayPrice = $("#calPayPrice").val() !=null ? parseInt(unComma($("#calPayPrice").val())) : 0;
            var totalCalPayPrice = parseInt(calPayPrice) - parseInt(unComma(prvRemainPrice));
            if(totalCalPayPrice < 0) totalCalPayPrice = 0;

            console.log('totalCalPayPrice : ', totalCalPayPrice);
            $("#totalCalPayPrice").val(totalCalPayPrice);
            $("#totalCalPayPrice2").val(totalCalPayPrice);

            // 장바구니 삭제 버튼 이벤트 처리.
            $("#delBtn"+idx).click(function(e) {
                e.preventDefault();

                if(usrId == '') {
                    alert('로그인 하세요.');
                    location.href = "/";
                    return false;
                }

                console.log('장바구니 2pCode del val['+idx+'] : ', $("#2pCode"+idx).val());
                console.log('장바구니 2pUniqCode del val['+idx+'] : ', $.trim($("#2pUniqCode"+idx).val()));
                console.log('2pUniqCode : ', $("#2pUniqCode ").val());

                // 조회 처리.
                $.ajax({
                    url : "/purchase/cart/delete",
                    type : "post",
                    dataType : "json",
                    data : {
                        'pCode' : $.trim($("#2pCode"+idx).val()),
                        'pUniqCode' : $.trim($("#2pUniqCode"+idx).val()),
                        'pDiv' : $.trim($("#2pDiv"+idx).val()),
                        'pPairCodeYn' : $.trim($("#2pPairCodeYn"+idx).val()),
                        'pPairCode' : $.trim($("#2pPairCode"+idx).val()),
                    },
                    success : function(data) {
                        // tList2에 리스트 출력.
                        var addHTML = "";
                        if(data.cnt > 0) {
                            $.each(data.list, function (i, item) {
                                if(item.pDiv=="M") {
                                    addHTML += "<tr><td colspan='5' class='pdno'>";
                                    addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                    addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='20%'><col width='8%'></colgroup>";
                                }
                                addHTML += "<tr>";
                                addHTML += "<td>" + item.pCode + "<input type='hidden' id='2pCode" + i + "' name='2pCode' value='" + item.pCode + "'/></td>";
                                addHTML += "<td>" + item.pDivNm + "<input type='hidden' id='2pDiv" + i + "' name='2pDiv' value='" + item.pDiv + "'/></td>";
                                addHTML += "<td>" + item.pNm + "<input type='hidden' id='2pUniqCode" + i + "' name='2pUniqCode' value='" + item.pUniqCode + "'/></td>";
                                if(item.pType=="HDW") {
                                    addHTML += "<td>" + item.pCount +"</td>";
                                    addHTML += "<td>" + comma(parseInt(item.pPrice) * parseInt(item.pCount)) + "<input type='hidden' id='2pPrice" + i + "' name='2pPrice' value='" + parseInt(item.pPrice) * parseInt(item.pCount) + "'/>";
                                    addHTML += "<input type='hidden' id='2pCnt" + i + "' name='2pCnt' value='" + item.pCount + "'/>";
                                    addHTML += "</td>";
                                } else {
                                    addHTML += "<td>" + comma(item.pPrice) + "<input type='hidden' id='2pPrice" + i + "' name='2pPrice' value='" + item.pPrice + "'/></td>";
                                }
                                //addHTML += "<td>" + comma(item.pPrice) + "<input type='hidden' id='2pPrice" + i + "' name='2pPrice' value='" + item.pPrice + "'/></td>";
                                addHTML += "<td><input type='button' id='delBtn" + i + "' name='delBtn' src='/images/remove.png'' class='remove' value='삭제'/>";
                                addHTML += "<input type='hidden' id='2pPoptCnt" + i + "' name='2pPoptCnt' value='" + item.optCnt + "'/>";
                                addHTML += "<input type='hidden' id='2pPairCodeYn"+i+"' name='2pPairCodeYn' value='"+item.pPairCodeYn+"'/>";
                                addHTML += "<input type='hidden' id='2pPairCode"+i+"' name='2pPairCode' value='"+item.pPairCode+"'/>";
                                addHTML += "</td></tr>";
                                if(item.pDiv=="M") {
                                    addHTML += "</table></td></tr>";
                                }
                                // 선택버튼 활성화.
                                if(item.pCode=="APP170109ASS2") {
                                    $("#tList1 > tr").each(function(idx) {
                                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                            $("#1btn"+idx).css("display","inline");
                                        }
                                    });
                                } else {
                                    $("#tList1 > tr").each(function(idx) {
                                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                            $("#1btn"+idx).css("display","none");
                                        }
                                    });
                                }
                            });
                            $("#tList2").html(addHTML);
                        } else {
                            $("#tList2").html(addHTML);
                            // 원격지원 버튼 지우기.
                            if($("#tList1 > tr").length > 0) {
                                $("#tList1 > tr").each(function(idx) {
                                    if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                        $("#1btn"+idx).css("display", "none");
                                    }
                                });
                            }
                        }
                        reload2();
                        ajaxCalculate();
                    },
                    error : function(err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                });

            });
        });

        // 계산모듈 호출 처리.
        ajaxCalculate();

        // 주문 저장 처리.
        $("#saveBtn").click(function(e) {
            e.preventDefault();

            if(usrId == '') {
                alert('로그인 하세요.');
                location.href = "/";
                return false;
            }

            if ($("#tList2 > tr").length > 0) {

                var termDays = "0";
                // 기간 서비스 인 경우 체크.
                if(productType == "SVC") {
                    // 이용기간 서비스 라디오 버튼 값 취득.
                    termDays = $("input:radio[name='termDays']:checked").val();
                    $("#useTermDays").val(termDays);
                    $("#dcntPercent").val($("#disCountPct").val());
                    // Validation 체크
                    var prvUsrTermDays = $("#prvUsrTermDays").val();
                    var prvRemainDays = $("#prvRemainDays").val();

                    var optCnt1 = 0;
                    var optCnt2 = 0;
                    // 이용내역 리스트 취득.
                    $("#sList0 > tr").each(function (idx) {
                        if ($("#prvDiv" + idx).val() == "옵션") {
                            optCnt1 += 1;
                        }
                    });
                    console.log('opt1 : ', optCnt1);
                    $("#tList2 > tr").each(function (idx2) {
                        if ($("#2pDiv" + idx2).val() == "O") {
                            optCnt2 += 1;
                        }
                    });
                    console.log('opt2 : ', optCnt2);
                    if (optCnt1 == optCnt2 && prvUsrTermDays == termDays) {
                        alert("이미 사용중인 서비스입니다.");
                        return false;
                    } else if (optCnt1 > optCnt2 && prvUsrTermDays == termDays) {
                        alert("이미 사용중인  서비스가 있습니다.");
                        return false;
                    } else if (optCnt1 == optCnt2 && prvUsrTermDays > termDays) {
                        alert("사용중인 서비스 360 일에서 30일로 전환할 수 없습니다.");
                        return false;
                    } else if (optCnt1 > optCnt2 && prvUsrTermDays > termDays) {
                        alert("사용중인 서비스 360 일에서 30일로 전환할 수 없습니다.");
                        return false;
                    }

                    // 기존 결제 정보 (잔여일) 취득.
                    if ($("#rePayLength").val() > 0) {
                        console.log('prvOrderNo : ', $("#prvOrderNo").val());
                        console.log('remainDays : ', $("#remainDays").val());
                        console.log('usedDays : ', $("#usedDays").val());
                        console.log('remainPrice : ', $("#remainPrice").val());
                        console.log('subtractPrice : ', $("#subtractPrice").val());

                        $("#prevOrderNo").val($("#prvOrderNo").val());
                        $("#remainDays").val($("#prvRemainDays").val());
                        $("#usedDays").val($("#prvUsredDays").val());
                        $("#remainPrice").val($("#prvRemainPrice").val());
                        $("#subtractPrice").val($("#discPrice").val());

                    }
                }
                /*
                 var selectedPcount = "0";
                 // 서비스 타입이 하드웨어인 경우
                 if(productType == "HDW") {
                 selectedPcount = $("#pCount option:selected").val();
                 if(selectedPcount == "") {
                 alert("상품 갯수를 선택하여 주세요.");
                 $("#pCount").focus();
                 return;
                 }
                 }
                 */
                var dataValues = {};
                var categoryNo = $.trim($("#categoryNo").val());
                if(productCateNm == "온라인게임" || productCateNm == "구글/카카오게임") {

                    var idType = $.trim($("input:radio[name='idType']:checked").val());
                    var gameUsrId = $.trim($("#gameUsrId").val());
                    var gameUsrPwd1 = $.trim($("#gameUsrPwd1").val());
                    var gameUsrPwd2 = $.trim($("#gameUsrPwd2").val());
                    var gameCharNm = $.trim($("#gameCharNm").val());
                    var gameLevelServer = $.trim($("#gameLevelServer").val());
                    var gameEtc = $.trim($("#gameEtc").val());

                    if(idType == "") {
                        alert("계정을 선택하여 주세요");
                        return false;
                    }
                    if(gameUsrId == "") {
                        alert("게임 계정을 입력하여주세요.");
                        $("#gameUsrId").focus();
                        return false;
                    }
                    if(gameUsrPwd1 == "") {
                        alert("계정 패스워드를 입력하여주세요.");
                        $("#gameUsrPwd1").focus();
                        return false;
                    }
                    if(gameUsrPwd2 == "") {
                        alert("계정 확인 패스워드를 입력하여주세요.");
                        $("#gameUsrPwd2").focus();
                        return false;
                    }
                    if(gameUsrPwd1 != gameUsrPwd2) {
                        alert("입력하신 패스워드와 확인 패스워드가 일치하지 않습니다.");
                        $("#gameUsrPwd2").focus();
                        return false;
                    }
                    /*
                    if(gameCharNm == "") {
                        alert("게임 캐릭터명을 입력하여주세요.");
                        $("#gameCharNm").focus();
                        return false;
                    }
                    if(gameLevelServer == "") {
                        alert("게임 레벨 / 서버명을 입력하여주세요.");
                        $("#gameLevelServer").focus();
                        return false;
                    }
                    */

                    dataValues = {
                        'termDays' : termDays,
                        'totalCalPayPrice' : $("#totalCalPayPrice").val(),
                        'cmpltYn' : $("#cmpltYn").val(),
                        'useTermDays' : $("#useTermDays").val(),
                        'prevOrderNo' : $("#prevOrderNo").val(),
                        'remainDays' : $("#remainDays").val(),
                        'usedDays' : $("#usedDays").val(),
                        'remainPrice' : $("#remainPrice").val(),
                        'subtractPrice' : $("#subtractPrice").val(),
                        'dcntPercent' : $("#dcntPercent").val(),
                        'productCode' : $("#productCode").val(),
                        'productUniqCode' : $("#productUniqCode").val(),
                        //'productCount' : selectedPcount
                        'categoryNo' : categoryNo,
                        'idType' : idType,
                        'gameUsrId' : gameUsrId,
                        'gameUsrPwd' : gameUsrPwd1,
                        'gameCharNm' : gameCharNm,
                        'gameLevelServer' : gameLevelServer,
                        'gameEtc' : gameEtc,
                        'codeType' : '',
                        'gameText' : '',
                        'starId' : '',
                        'starPwd' : ''
                    };

                } else if(productCateNm == "구글기프트카드") {

                    var codeType = $.trim($("input:radio[name='codeType']:checked").val());
                    var gameText = $.trim($("#gameText").val());
                    if (codeType == "") {
                        alert("코드를 받으실 방법을 선택하여주세요.");
                        return false;
                    } else {
                        if (codeType == "kakao") {
                            if (gameText == "") {
                                alert("카카오ID를 입력하세요.\n 카카오ID가 없는 경우 '휴대폰번호로 친추요망'을 \n 적어주시면 친구 추가후 처리해 드리겠습니다.");
                                $("#gameText").focus();
                                return false;
                            }
                        }
                        if (codeType == "email") {
                            if (gameText == "") {
                                alert("이메일을 입력하세요.");
                                $("#gameText").focus();
                                return false;
                            }
                        }
                        if (codeType == "mobile") {
                            if (gameText == "") {
                                alert("휴대폰번호를 입력하세요.");
                                $("#gameText").focus();
                                return false;
                            }
                        }
                        if (codeType == "etc") {
                            if (gameText == "") {
                                alert("기타 사항을 입력하세요");
                                $("#gameText").focus();
                                return false;
                            }
                        }
                    }
                    dataValues = {
                        'termDays': termDays,
                        'totalCalPayPrice': $("#totalCalPayPrice").val(),
                        'cmpltYn': $("#cmpltYn").val(),
                        'useTermDays': $("#useTermDays").val(),
                        'prevOrderNo': $("#prevOrderNo").val(),
                        'remainDays': $("#remainDays").val(),
                        'usedDays': $("#usedDays").val(),
                        'remainPrice': $("#remainPrice").val(),
                        'subtractPrice': $("#subtractPrice").val(),
                        'dcntPercent': $("#dcntPercent").val(),
                        'productCode': $("#productCode").val(),
                        'productUniqCode': $("#productUniqCode").val(),
                        //'productCount' : selectedPcount
                        'categoryNo': categoryNo,
                        'idType': '',
                        'gameUsrId': '',
                        'gameUsrPwd': '',
                        'gameCharNm': '',
                        'gameLevelServer': '',
                        'gameEtc': '',
                        'codeType': codeType,
                        'gameText': gameText,
                        'starId' : '',
                        'starPwd' : ''
                    };
                } else if(productCateNm == "아프리카별풍선") {

                    var starId = $.trim($("#starId").val());
                    var starPwd1 = $.trim($("#starPwd1").val());
                    var starPwd2 = $.trim($("#starPwd2").val());

                    if(starId == "") {
                        alert("아프리카 계정 ID를 입력하여주세요.");
                        $("#starId").focus();
                        return false;
                    }
                    if(starPwd1 == "") {
                        alert("계정 패스워드를 입력하여주세요.");
                        $("#starPwd1").focus();
                        return false;
                    }
                    if(starPwd2 == "") {
                        alert("계정 확인 패스워드를 입력하여주세요.");
                        $("#starPwd2").focus();
                        return false;
                    }
                    if(starPwd1 != starPwd2) {
                        alert("입력하신 패스워드와 확인 패스워드가 일치하지 않습니다.");
                        $("#starPwd2").focus();
                        return false;
                    }

                    dataValues = {
                        'termDays': termDays,
                        'totalCalPayPrice': $("#totalCalPayPrice").val(),
                        'cmpltYn': $("#cmpltYn").val(),
                        'useTermDays': $("#useTermDays").val(),
                        'prevOrderNo': $("#prevOrderNo").val(),
                        'remainDays': $("#remainDays").val(),
                        'usedDays': $("#usedDays").val(),
                        'remainPrice': $("#remainPrice").val(),
                        'subtractPrice': $("#subtractPrice").val(),
                        'dcntPercent': $("#dcntPercent").val(),
                        'productCode': $("#productCode").val(),
                        'productUniqCode': $("#productUniqCode").val(),
                        //'productCount' : selectedPcount
                        'categoryNo': categoryNo,
                        'idType': '',
                        'gameUsrId': '',
                        'gameUsrPwd': '',
                        'gameCharNm': '',
                        'gameLevelServer': '',
                        'gameEtc': '',
                        'codeType': '',
                        'gameText': '',
                        'starId' : starId,
                        'starPwd' : starPwd1
                    };
                } else {
                    dataValues = {
                        'termDays' : termDays,
                        'totalCalPayPrice' : $("#totalCalPayPrice").val(),
                        'cmpltYn' : $("#cmpltYn").val(),
                        'useTermDays' : $("#useTermDays").val(),
                        'prevOrderNo' : $("#prevOrderNo").val(),
                        'remainDays' : $("#remainDays").val(),
                        'usedDays' : $("#usedDays").val(),
                        'remainPrice' : $("#remainPrice").val(),
                        'subtractPrice' : $("#subtractPrice").val(),
                        'dcntPercent' : $("#dcntPercent").val(),
                        'productCode' : $("#productCode").val(),
                        'productUniqCode' : $("#productUniqCode").val(),
                        //'productCount' : selectedPcount
                        'categoryNo' : categoryNo,
                        'idType' : '',
                        'gameUsrId' : '',
                        'gameUsrPwd' : '',
                        'gameCharNm' : '',
                        'gameLevelServer' : '',
                        'gameEtc' : '',
                        'codeType' : '',
                        'gameText' : '',
                        'starId' : '',
                        'starPwd' : ''
                    };
                }

                // 정산결과가 0 인 체크.
                if($("#totalCalPayPrice").val()=="0" && $("#cmpltYn") == null || $("#totalCalPayPrice").val()=="0" && $("#cmpltYn") == "N") {
                    alert("결제예정금액이 0원입니다.\n 다시 확인하시고 처리해주세요!");
                    return false;
                }

                // 조회 처리.
                $.ajax({
                    url: "/purchase/order",
                    type: "post",
                    dataType: "json",
                    data : dataValues,
                    success: function (data) {
                        // result 데이타셋팅.
                        wrapWindowByMask();
                    },
                    error: function (err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                });

            } else {
                alert("선택된 서비스가 없습니다.");
            }
        });


        // 결제하기 관련
        $("#tList3 > tr").each(function(idx) {

            // 결제하기 삭제 버튼 이벤트 처리.
            $("#del3Btn"+idx).click(function(e) {
                e.preventDefault();

                if(usrId == '') {
                    alert('로그인 하세요.');
                    location.href = "/";
                    return false;
                }

//console.log('결제 삭제 del val['+idx+'] : ', $("#3pPcode"+idx).val());
//console.log('결제 삭제 del val['+idx+'] : ', $.trim($("#3pUniqCode"+idx).val()));
                console.log('orderNo : ', $.trim($("#orderNo").val()));

                // 이용기간 서비스 라디오 버튼 값 취득.
                var termDays = $("input:radio[name='termDays']:checked").val();

                $("#pCode3").val($("#3pPcode"+idx).val());
                $("#pUniqCode3").val($("#3pUniqCode"+idx).val());
                $("#pDiv3").val($("#3pDiv"+idx).val());
                $("#pPairCodeYn3").val($("#3pPairCodeYn"+idx).val());
                $("#pPairCode3").val($("#3pPairCode"+idx).val());

                var dataValues = {
                    'termDays' : termDays,
                    'totalCalPayPrice' : $("#totalCalPayPrice").val(),
                    'cmpltYn' : $("#cmpltYn").val(),
                    'useTermDays' : $("#useTermDays").val(),
                    'pCode3' : $("#pCode3").val(),
                    'pUniqCode3' : $("#pUniqCode3").val(),
                    'pDiv3' : $("#pDiv3").val(),
                    'pPairCodeYn3' : $("#pPairCodeYn3").val(),
                    'pPairCode3' : $("#pPairCode3").val(),
                    'orderNo' : $("#orderNo").val()
                };

                // 조회 처리.
                $.ajax({
                    url: "/purchase/order/delete",
                    type: "post",
                    dataType: "json",
                    data : dataValues,
                    success: function (data) {
                        // tList3에 리스트 출력.
                        var addHTML = "";
                        if (data.cnt > 0) {
                            $("#tList3").html("");
                            var payPrice = 0;
                            $.each(data.list, function (i, item) {
                                if(item.pDiv=="M") {
                                    addHTML += "<tr><td colspan='5' class='pdno'>";
                                    addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                    addHTML += "<colgroup><col width='22%'><col width='10%'><col width='26%'><col><col width='15%'></colgroup>";
                                }
                                addHTML += "<tr>";
                                addHTML += "<td>" + item.pCode + "<input type='hidden' id='payOrderNo"+i+"' name='payOrderNo' value='"+item.orderNo+"'/></td>";
                                addHTML += "<td>" + item.pDivNm + "<input type='hidden' id='3pDiv"+i+"' name='3pDiv' value='"+item.pDiv+"'/></td>";
                                addHTML += "<td>" + item.pNm + "</td>";
                                addHTML += "<td>" + comma(item.pPrice) + "<input type='hidden' id='3pPrice"+i+"' name='3pPrice' value='"+item.pPrice+"'/>";
                                addHTML += "<input type='hidden' id='3pPcode"+i+"' name='3pPcode' value='"+item.pCode+"'/>";
                                addHTML += "<input type='hidden' id='3pPairCodeYn"+i+"' name='3pPairCodeYn' value='"+item.pPairCodeYn+"'/>";
                                addHTML += "<input type='hidden' id='3pPairCode"+i+"' name='3pPairCode' value='"+item.pPairCode+"'/>";
                                addHTML += "<input type='hidden' id='3pUniqCode"+i+"' name='3pUniqCode' value='"+item.pUniqCode+"'/>";
                                addHTML += "</td>";
                                addHTML += "<td><input type='image' id='del3Btn"+ i +"' name='delBtn' src='/images/remove.png' class='remove' value='삭제'/></td>";
                                addHTML += "</tr>";
                                if(item.pDiv=="M") {
                                    addHTML += "</table></td></tr>";
                                }
                                if(item.pCode=="APP170109ASS2") {
                                    $("#tList1 > tr").each(function(idx) {
                                        if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                            $("#1btn"+idx).css("display", "inline");
                                        }
                                    });
                                }
                                // 총 예상 가격
                                //payPrice += item.totalPrice;
                            });
                            $("#tList3").html(addHTML);

                        } else {
                            $("#tList3").html(addHTML);
                        }
                        reload3();
                        // 계산처리.
                        //ajaxPayCalculate();
                    },
                    error: function (err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                });


                //$("#frm3").attr("action","/purchase/order/delete");
                //$("#frm3").submit();
            });
        });

        // 카트 전체 삭제 버튼 이벤트 처리.
        $("#cartAllDelBtn").click(function(e) {
            e.preventDefault();

            if(usrId == '') {
                alert('로그인 하세요.');
                return false;
            }

            if($("#tList2 > tr").length <= 0) {
                return false;
            }

            // 조회 처리.
            $.ajax({
                url : "/purchase/cart/alldel",
                type : "post",
                dataType : "json",
                success : function(data) {
                    // tList2에 리스트 출력.
                    var addHTML = "";
                    if(data.cnt > 0) {
                        $.each(data.list, function (i, item) {
                            addHTML += "<tr>";
                            if(item.pDiv=="M") {
                                addHTML += "<td colspan='5' class='pdno'>";
                                addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                addHTML += "<colgroup><col width='22%'><col width='10%'><col><col width='20%'><col width='8%'></colgroup>";
                            }
                            addHTML += "<td>" + item.pCode + "<input type='hidden' id='2pCode" + i + "' name='2pCode' value='" + item.pCode + "'/></td>";
                            addHTML += "<td>" + item.pDivNm + "<input type='hidden' id='2pDiv" + i + "' name='2pDiv' value='" + item.pDiv + "'/></td>";
                            addHTML += "<td>" + item.pNm + "<input type='hidden' id='2pUniqCode" + i + "' name='2pUniqCode' value='" + item.pUniqCode + "'/></td>";
                            if(item.pType=="HDW") {
                                addHTML += "<td>" + comma(parseInt(item.pPrice) * parseInt(item.pCount)) + "</td>";
                                addHTML += "<td>" + item.pCount + "<input type='hidden' id='2pPrice" + i + "' name='2pPrice' value='" + parseInt(item.pPrice) * parseInt(item.pCount) + "'/>";
                                addHTML += "<input type='hidden' id='2pCnt" + i + "' name='2pCnt' value='" + item.pCount + "'/>";
                                addHTML += "</td>";
                            } else {
                                addHTML += "<td>" + comma(item.pPrice) + "<input type='hidden' id='2pPrice" + i + "' name='2pPrice' value='" + item.pPrice + "'/></td>";
                            }
                            addHTML += "<td><input type='button' id='delBtn" + i + "' name='delBtn' src='/images/remove.png'' class='remove' value='삭제'/>";
                            addHTML += "<input type='hidden' id='2pPoptCnt" + i + "' name='2pPoptCnt' value='" + item.optCnt + "'/>";
                            addHTML += "</td></tr>";
                        });
                        $("#tList2").html(addHTML);
                    } else {
                        $("#tList2").html(addHTML);
                    }
                    // 원격지원 버튼 지우기.
                    if($("#tList1 > tr").length > 0) {
                        $("#tList1 > tr").each(function(idx) {
                            if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                $("#1btn"+idx).css("display", "none");
                            }
                        });
                    }

                    reload2();
                    ajaxCalculate();
                },
                error : function(err) {
                    alert("errCode : " + JSON.stringify(err));
                }
            });
            /*
             $("#frm2").attr("method", "post");
             $("#frm2").attr("action", "/purchase/cart/alldel");
             $("#frm2").submit();
             */

        });

        // (결제하기) 전체 삭제 버튼 이벤트 처리.
        $("#allDelBtn").click(function(e) {
            e.preventDefault();

            console.log('tList3 : ', $("#tList3 > tr").length);

            if($("#tList3 > tr").length <= 0) {
                return false;
            }
            var termDays = $("input:radio[name='termDays']:checked").val();

            var dataValues = {
                'termDays' : termDays,
                'orderNo' : $("#orderNo").val()
            };

            // 조회 처리.
            $.ajax({
                url: "/purchase/order/alldel",
                type: "post",
                dataType: "json",
                data : dataValues,
                success: function (data) {
                    // tList3에 리스트 출력.
                    var addHTML = "";
                    if (data.cnt > 0) {
                        $("#tList3").html("");
                        var payPrice = 0;
                        $.each(data.list, function (i, item) {
                            if(item.pDiv=="M") {
                                addHTML += "<tr><td colspan='5' class='pdno'>";
                                addHTML += "<table border='0' cellspacing='0' width='100%' class='table_style0 bgc2 bbno'>";
                                addHTML += "<colgroup><col width='22%'><col width='10%'><col width='26%'><col><col width='15%'></colgroup>";
                            }
                            addHTML += "<tr>";
                            addHTML += "<td>" + item.pCode + "<input type='hidden' id='orderNo"+i+"' name='orderNo' value='"+item.orderNo+"'/></td>";
                            addHTML += "<td>" + item.pDivNm + "<input type='hidden' id='3pDiv"+i+"' name='3pDiv' value='"+item.pDiv+"'/></td>";
                            addHTML += "<td>" + item.pNm + "</td>";
                            addHTML += "<td>" + comma(item.pPrice) + "<input type='hidden' id='3pPrice"+i+"' name='3pPrice' value='"+item.pPrice+"'/>";
                            addHTML += "<input type='hidden' id='3pPcode"+i+"' name='3pPcode' value='"+item.pCode+"'/>";
                            addHTML += "<input type='hidden' id='3pPairCodeYn"+i+"' name='3pPairCodeYn' value='"+item.pPairCodeYn+"'/>";
                            addHTML += "<input type='hidden' id='3pPairCode"+i+"' name='3pPairCode' value='"+item.pPairCode+"'/>";
                            addHTML += "<input type='hidden' id='3pUniqCode"+i+"' name='3pUniqCode' value='"+item.pUniqCode+"'/>";
                            addHTML += "</td>";
                            addHTML += "<td><input type='image' id='del3Btn'"+ i +"' name='delBtn' src='/images/remove.png' class='remove' value='삭제'/></td>";
                            addHTML += "</tr>";
                            if(item.pDiv=="M") {
                                addHTML += "</table></td></tr>";
                            }
                            if(item.pCode=="APP170109ASS2") {
                                $("#tList1 > tr").each(function(idx) {
                                    if($("#1pCode"+idx).val() == "APP170109ASS3") {
                                        $("#1btn"+idx).css("display", "inline");
                                    }
                                });
                            }
                            // 총 예상 가격
                            //payPrice += item.totalPrice;
                        });
                        $("#tList3").html(addHTML);

                    } else {
                        $("#tList3").html(addHTML);
                    }
                    // 계산처리.
                    ajaxPayCalculate();
                },
                error: function (err) {
                    alert("errCode : " + JSON.stringify(err));
                }
            });

            /*
             $("#frm3").attr("method", "post");
             $("#frm3").attr("action", "/purchase/order/alldel");
             $("#frm3").submit();
             */

        });

        // 이용기간 라디오버튼 이벤트 처리.
        $("input:radio[name='termDays']").click(function() {

            var pCode = []; var pDiv = []; var pUniqCode = []; var pPrice = []; var pOptCnt = [];
            var termDays = $("input:radio[name='termDays']:checked").val();
            var selectedPcount = $("#pCount option:selected").val();
            var prvRemainPrice = 0;

            // 잔여금액 셋팅.
            if($("#sList0").length > 0) {
                prvRemainPrice = $("#prvRemainPrice").val() !=null ? $("#prvRemainPrice").val() : 0;
                prvRemainPrice = unComma(prvRemainPrice);
            }

            if($("#tList2 > tr").length > 0) {
                $("#tList2 > tr").each(function(idx) {
                    pCode[idx] = $("#2pCode"+idx).val();
                    pDiv[idx] = $("#2pDiv"+idx).val();
                    pUniqCode[idx] = $("#2pUniqCode"+idx).val();
                    pPrice[idx] = $("#2pPrice"+idx).val();
                    pOptCnt[idx] = $("#2pPoptCnt"+idx).val();
                });
                $.ajax({
                    url : "/purchase/calculate",
                    type : "post",
                    dataType : "json",
                    data : { 'pCode' : pCode, 'pDiv' : pDiv, 'pUniqCode' : pUniqCode, 'pPrice' : pPrice, 'pOptCnt' : pOptCnt,
                        'pCount' : selectedPcount, 'prvRemainPrice' : prvRemainPrice, 'termDays' : termDays,
                        'productType' : productType, 'pCodeCnt' : pCode.length
                    },
                    success : function(data) {
                        // tList\2에 리스트 출력.
                        // 총 금액
                        $("#calPayPrice").val(comma(data.totalCalPrice));
                        // 잔여 금액 셋팅.
                        $("#calRemainPrice").val(comma(data.prvRemainPrice));
                        // 할인금액
                        $("#discPrice").val(comma(data.disCountPrice));
                        // 결정예정금액
                        $("#totalCalPayPrice").val(comma(data.calPayPrice));
                        $("#totalCalPayPrice2").val(comma(data.calPayPrice));
                        if(parseInt(data.baseCalPayPrice) < 0) {
                            $("#basePayPart").css("display","inline");
                            // 원 결정예정금액
                            $("#baseCalPayPrice").val(comma(data.baseCalPayPrice));
                        } else {
                            $("#basePayPart").css("display","none");
                            // 원 결정예정금액
                            $("#baseCalPayPrice").val(comma(data.baseCalPayPrice));
                        }
                        // 할인율
                        $("#disCountPct").val(data.disCountPct);
                        // 정산결과가 0인 체크 셋팅.
                        $("#cmpltYn").val(data.cmpltYn);
                        // 사용기간 라디오버튼 셋팅.
                        if(data.termDays=="30") {
                            $("#termDays30").attr("checked", true);
                        } else {
                            $("#termDays360").attr("checked", true);
                        }
                        // 하드웨어 인경우 갯수표시.
                        if(data.pType=="HDW") {
                            $("#pCnt").val(data.pCnt !=null ? data.pCnt : 0);
                        }
                    },
                    error : function(err) {
                        alert("errCode : " + JSON.stringify(err));
                    }
                });
            }
        });

        // 결제 처리버튼 이벤트 처리.
        $("#payBtn").click(function(e) {
            e.preventDefault();
            // 이용기간 서비스 라디오 버튼 값 취득.
            //var termDays = $("input:radio[name='termDays']:checked").val();
            //$("#uTermDays").val(termDays);
            //$("#dcntPercent").val($("#disCountPct").val());


            // 결제가격 0 인지 체크.
            var totalPayPrice = $("#totalPayPrice").val() !=null ? parseInt(unComma($("#totalPayPrice").val())) : 0;
            var payCmpltYn = $("#payCmpltYn").val() !=null ? $("#payCmpltYn").val() : '';
            if(totalPayPrice == 0 && payCmpltYn == '' || totalPayPrice == 0 && payCmpltYn == "N") {
                alert("결제금액이 0원입니다. 다시 확인하시고 결제 신청해주세요.");
                return false;
            }

            // 결제 수단 체크.
            var payMethodChk = $(":radio[name='payMethod']:checked").val();
            if(payMethodChk == null) {
                alert("결제수단을 선택하여 주세요!");
                $("#payMethod4").focus();
                return false;
            }

            var ret = confirm("결제 하시겠습니까?");
            if(ret==false) {
                alert("결제취소 하셨습니다.");
                return false;
            }

            $("#frm2").attr("method", "post");
            $("#frm2").attr("action", "/pay/new");
            $("#frm2").submit();

        });

        // 팝업 호출 함수.
        function openPopup(el) {

            $('.'+el).magnificPopup({
                items : {
                    src : '/purchase/paypopup',
                    type : 'iframe'
                }
            });
        }

        // 뒤 검은 마스크를 클릭시에도 모두 제거하도록 처리합니다.
        $('.mask').click(function () {
            $(this).hide();
            $('.window').hide();
        });

        // 코드 받을 방법 이벤트 버튼 처리.
        $("input:radio[name='codeType']").click(function() {
            var cType = $("input:radio[name='codeType']:checked").val();
            if(cType == "kakao") {
                $("#textLevel").text("카카오톡");
                //"카카오톡ID가 없는경우 '휴대폰 번호로 친추 요망'을 적어주시면 친구 추가후 처리해 드리겠습니다."
                //$("#gameText").placeholder();
            }
            if(cType == "email") {
                $("#textLevel").text("이메일");
            }
            if(cType == "mobile") {
                $("#textLevel").text("핸드폰번호");
            }
            if(cType == "etc") {
                $("#textLevel").text("기타");
            }
        });



    });

    // 콤마 붙이기
    function comma(num) {
        var reg = /(^[+-]?\d+)(\d{3})/;
        num += '';
        while(reg.test(num)) {
            num = num.replace(reg, '$1' + ',' + '$2');
        }
        return num;
    }
    // 콤마 제거
    function unComma(num) {
        if(num!=null && num!='') {
            return (num.replace(/\,/g, ""));
        } else {
            num = 0;
            return num;
        }
    }
    /**
     * 월을 일로 변환 처리.
     * @param month
     * @returns {number}
     */
    function monthToDay(month) {
        var day = 30;
        var retVal = 0;
        if(month != null) {
            retVal = parseInt(month) * day;
        }
        return retVal;
    }

    // 레이어 팝업 함수.
    function wrapWindowByMask(){
        // 화면의 높이와 너비를 변수로 만듭니다.
        var maskHeight = $(document).height();
        var maskWidth = $(window).width();

        // 마스크의 높이와 너비를 화면의 높이와 너비 변수로 설정합니다.
        $('.mask').css({'width':maskWidth,'height':maskHeight});

        // fade 애니메이션 : 1초 동안 검게 됐다가 80%의 불투명으로 변합니다.
        $('.mask').fadeIn(1000);
        $('.mask').fadeTo("slow",0.8);

        // 레이어 팝업을 가운데로 띄우기 위해 화면의 높이와 너비의 가운데 값과 스크롤 값을 더하여 변수로 만듭니다.
        var left = ( $(window).scrollLeft() + ( $(window).width() - $('.window').width()) / 2 );
        var top = ( $(window).scrollTop() + ( $(window).height() - $('.window').height()) / 2 );

        // css 스타일을 변경합니다.
        $('.window').css({'left':left,'top':top, 'position':'absolute'});

        // 레이어 팝업을 띄웁니다.
        $('.window').show();
    }
</script>